package vine.entity;

import org.lwjgl.glfw.GLFW;

import vine.event.KeyEvent;
import vine.event.MouseButtonEvent;
import vine.math.Vector2f;

public class PlayerPawn extends GameEntity {

    public double destinationX = this.getX();
    public double destinationY = this.getY();

    @Override
    public strictfp void update(float delta) {

        Vector2f direction = new Vector2f(velocity.getX(), velocity.getY());
        direction.add(Math.abs((float) destinationX - this.getX()) > 0.001f ? (float) destinationX - this.getX() : 0,
                Math.abs((float) destinationY - this.getY()) > 0.001f ? (float) destinationY - this.getY() : 0);
        direction.setX(direction.getX() < -64 ? -64 : (direction.getX() > 64 ? 64 : direction.getX()));
        direction.setY(direction.getY() < -64 ? -64 : (direction.getY() > 64 ? 64 : direction.getY()));
        velocity.setX(direction.getX());
        velocity.setY(direction.getY());
        this.position.add(velocity.getX() * delta, velocity.getY() * delta, 0);
    }

    @Override
    public boolean onMouseButtonEvent(MouseButtonEvent mouseEvent) {
        destinationX = mouseEvent.getX();
        destinationY = mouseEvent.getY();
        return true;
    }

    @Override
    public boolean onKeyEvent(KeyEvent keyEvent) {
        if (keyEvent.getAction() == 0) {
            if (keyEvent.getKey() == GLFW.GLFW_KEY_A) {
                velocity.setX(velocity.getX() < 64 ? velocity.getX() + 64 : 64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_D) {
                velocity.setX(velocity.getX() > -64 ? velocity.getX() - 64 : -64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_S) {
                velocity.setY(velocity.getY() < 64 ? velocity.getY() + 64 : 64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_W) {
                velocity.setY(velocity.getY() > -64 ? velocity.getY() - 64 : -64);
            }
        } else if (keyEvent.getAction() == 1) {
            if (keyEvent.getKey() == GLFW.GLFW_KEY_A) {
                velocity.setX(velocity.getX() > 64 ? 64 : velocity.getX() - 64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_D) {
                velocity.setX(velocity.getX() < -64 ? -64 : velocity.getX() + 64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_S) {
                velocity.setY(velocity.getY() < -64 ? -64 : velocity.getY() - 64);
            }
            if (keyEvent.getKey() == GLFW.GLFW_KEY_W) {
                velocity.setY(velocity.getX() > 64 ? 64 : velocity.getY() + 64);
            }
        }
        return true;
    }

    public void construct(int x, int y) {
        this.position.add(0, 0, 0.5f);
    }
}
