package vine.gameplay.entity;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.Clip;
import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.UnsupportedAudioFileException;

import org.lwjgl.glfw.GLFW;

import vine.event.KeyEvent;
import vine.input.InputAction;

/**
 * @author Steffen
 *
 */
public class PlayerPawn extends GameEntity {

    @Override
    public strictfp void update(final float delta) {
        this.position.add(velocity.getX() / 50 * delta, velocity.getY() / 50 * delta, 0);
    }

    private void onMoveButtonReleased(final int button) {
        switch (button) {
        case GLFW.GLFW_KEY_A:
            velocity.setX(velocity.getX() < 64 ? velocity.getX() + 64 : 64);
            break;
        case GLFW.GLFW_KEY_D:
            velocity.setX(velocity.getX() > -64 ? velocity.getX() - 64 : -64);
            break;
        case GLFW.GLFW_KEY_S:
            velocity.setY(velocity.getY() < 64 ? velocity.getY() + 64 : 64);
            break;
        case GLFW.GLFW_KEY_W:
            velocity.setY(velocity.getY() > -64 ? velocity.getY() - 64 : -64);
            break;
        default:
            break;
        }
    }

    private void onMoveButtonPressed(final int button) {
        switch (button) {
        case GLFW.GLFW_KEY_A:
            velocity.setX(velocity.getX() > 64 ? 64 : velocity.getX() - 64);
            break;
        case GLFW.GLFW_KEY_D:
            velocity.setX(velocity.getX() < -64 ? -64 : velocity.getX() + 64);
            break;
        case GLFW.GLFW_KEY_S:
            velocity.setY(velocity.getY() < -64 ? -64 : velocity.getY() - 64);
            break;
        case GLFW.GLFW_KEY_W:
            velocity.setY(velocity.getX() > 64 ? 64 : velocity.getY() + 64);
            break;
        default:
            break;
        }
    }

    @Override
    public boolean onKeyEvent(final KeyEvent keyEvent) {
        if (keyEvent.getAction() == InputAction.RELEASED) {
            onMoveButtonReleased(keyEvent.getKey());
        } else if (keyEvent.getAction() == InputAction.PRESS) {
            onMoveButtonPressed(keyEvent.getKey());
        }
        return true;
    }

    @Override
    public void construct(final int x, final int y) {
        this.position.add(0, 0, 0.5f);
        AudioInputStream audioIn = null;
        try {
            audioIn = AudioSystem.getAudioInputStream(Files.newInputStream(Paths.get("res/default/sound/door.wav")));
        } catch (UnsupportedAudioFileException e) {
        } catch (IOException e) {
        }
        Clip clip;
        try {
            clip = AudioSystem.getClip();
            clip.open(audioIn);
            clip.start();
        } catch (LineUnavailableException e) {
        }

    }
}
